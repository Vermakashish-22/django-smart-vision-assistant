{% extends 'base2.html' %}
{% load i18n static %}

{% block title %}Patient Dashboard{% endblock title %}

{% block content %}
{% comment %} 
<div class="container mx-lg-1 flex flex-col md:flex-row justify-around items-center gap-0 px-4 py-6">

    <!-- Left: Patient Profile Card -->
    <div class="w-full md:w-1/2">
        <div class="card shadow-md rounded-md">
            <!-- Card Header -->
            <div class="card-header flex justify-center items-center w-full" style="background-color: #948979;">
                <h3 class="card-title m-0 text-lg fw-bold text-uppercase text-white" style="letter-spacing: 0.3em;">
                    PATIENT PROFILE
                </h3>
            </div>

            <!-- Card Body -->
            <div class="card-body flex items-center justify-around px-6 py-4">
                <!-- Patient Details -->
                <div class="text-black text-left ml-lg-5 md:text-left w-full flex flex-col">
                    <p class="py-1"><strong>Name:</strong> {{ patient.name }}</p>
                    <p class="py-1"><strong>Age:</strong> {{ patient.age }}</p>
                    <p class="py-1"><strong>Blood Group:</strong> {{ patient.blood_group }}</p>
                    <p class="py-1"><strong>Contact:</strong> {{ patient.contact }}</p>
                    <p class="py-1"><strong>Email:</strong> {{ patient.email }}</p>
                </div>

                <!-- Patient Image -->
                <img src="{{ patient.image.url }}" 
                    alt="Patient Image" 
                    class="w-25 h-25 rounded-full mr-lg-5 shadow-md object-cover border border-gray-300 mb-4">

            </div>
        </div>
    </div>

    <!-- Right: Lottie Animation -->
    <div class="w-full md:w-1/2 flex flex-col justify-center items-center">

        <!-- Book Appointment Button -->
                <div class="mt-6 w-full flex justify-content-center">
                    <a href="{% url 'appointment_form' %}" 
                        class=" bg-gray-900 text-white px-5 py-3 text-md rounded hover:bg-gray-800 transition text-sm">
                        <i class="fas fa-calendar-plus mr-2"></i> Book Appointment
                    </a>
                </div>

        
        <dotlottie-wc
            src="https://lottie.host/4e01f41f-e552-419a-abaf-4481de1a02f9/q87QUz5DP5.lottie"
            style="width: 450px; height: 450px;"
            speed="1"
            autoplay
            loop>
        </dotlottie-wc>
    </div>
</div>

<div class="container flex justify-center items-center">
    <!-- Consultation History -->
    <div class="card shadow-sm w-75">
        <div class="card-header" style="background-color:#901E3E;">
            <h4 class="mb-0 text-white px-4">Your Consultations</h4>
        </div>
        <div class="card-body p-0">
            <table class="table table-hover mb-0 text-center">
                <thead class="thead-light">
                    <tr>
                        <th>S.No</th>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Doctor</th>
                        <th>Disease</th>
                        <th>Medicines</th>
                    </tr>
                </thead>
                <tbody>
                    {% for appointment in appointments %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ appointment.date }}</td>
                        <td>{{ appointment.time }}</td>
                        <td>{{ appointment.doctor.user.username }}</td>
                        <td>{{ appointment.user_prescription }}</td>
                        <td style="white-space: pre-wrap;">{{ appointment.ai_prescription }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6">No consultations found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script
    src="https://unpkg.com/@lottiefiles/dotlottie-wc@0.6.2/dist/dotlottie-wc.js"
    type="module"
></script>

{% endblock %} {% endcomment %}


<div class="container mx-auto px-4 py-8" style="font-family:'Crimson Text', serif;">

    <!-- Profile + Lottie -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-10 items-center">

        <!-- Profile Card -->
        <div class="bg-white shadow-xl rounded-md overflow-hidden border-l-9 border-[#1A365D] relative">
            <div class="bg-[#1A365D] px-6 py-4 transform ">
                <h3 class="text-white text-lg font-bold uppercase text-center" style="letter-spacing: 0.2em;">
                Patient Profile
                </h3>
            </div>

            <div class="flex flex-col md:flex-row p-6 gap-4 items-center" style="letter-spacing: 0.05em;">
                <div class="text-gray-800 text-md ml-3 w-full space-y-5">
                    <p><strong>Name:</strong> {{ patient.name }}</p>
                    <p><strong>Age:</strong> {{ patient.age }}</p>
                    <p><strong>Blood Group:</strong> {{ patient.blood_group }}</p>
                    <p><strong>Contact:</strong> {{ patient.contact }}</p>
                    <p><strong>Email:</strong> {{ patient.email }}</p>
                </div>

                <div class="shrink-1 mr-5">
                    <img src="{{ patient.image.url }}" 
                    alt="Patient Image" 
                    class="w-[300px] h-[200px] rounded-full shadow-md mr-5 object-cover border border-gray-300 mb-4">
                </div>             
            </div>
        </div>

        <!-- Lottie & Appointment Button -->
        <div class="flex flex-col items-center justify-center">
            <div class="flex gap-x-5">
                <a href="{% url 'consultation_form' %}" class="mb-6 bg-[#1A365D] hover:bg-[#153054] text-white px-6 py-3 rounded-xl shadow-md text-sm transition flex items-center gap-2">
                    <i class="fas fa-calendar-plus"></i> Check Symptoms
                </a>
                <a href="{% url 'appointment_form' %}" class="mb-6 bg-[#1A365D] hover:bg-[#153054] text-white px-6 py-3 rounded-xl shadow-md text-sm transition flex items-center gap-2">
                    <i class="fas fa-calendar-plus"></i> Book Appointment
                </a>
            </div>

            <dotlottie-wc
                src="https://lottie.host/4e01f41f-e552-419a-abaf-4481de1a02f9/q87QUz5DP5.lottie"
                style="width: 280px; height: 280px;"
                speed="1"
                autoplay
                loop>
            </dotlottie-wc>
        </div>
    </div>

    <!-- Consultations Table -->
    <div class="mt-10">
        <div class="bg-white shadow-xl rounded-xl overflow-hidden border-t-4 border-[#1A365D]">
            <div class="bg-[#1A365D] px-6 py-3 transform -skew-x-3">
                <h4 class="text-white text-lg uppercase text-center font-semibold skew-x-3">Your Consultations</h4>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full table-auto text-md divide-y divide-gray-200">
                    <thead class="bg-gray-200 text-gray-800 uppercase tracking-wide text-center">
                        <tr>
                        <th class="px-4 py-2">S.No</th>
                        <th class="px-4 py-2">Date</th>
                        <th class="px-4 py-2">Time</th>
                        <th class="px-4 py-2">Doctor</th>
                        <th class="px-4 py-2">Disease</th>
                        <th class="px-4 py-2">Medicines</th>
                        </tr>
                    </thead>
                    <tbody class="text-gray-800 bg-white text-center border border-gray-300">
                        {% for appointment in appointments %}
                        <tr class="hover:bg-gray-100 transition border-t border-b border-gray-300">
                            <td class="px-4 py-2 border border-gray-300">{{ forloop.counter }}</td>
                            <td class="px-4 py-2 border border-gray-300">{{ appointment.date }}</td>
                            <td class="px-4 py-2 border border-gray-300">{{ appointment.time }}</td>
                            <td class="px-4 py-2 border border-gray-300 text-center">
                                {% if appointment.doctor %}
                                    Dr. {{ appointment.doctor.user.first_name }}
                                {% else %}
                                    AI Consulted
                                {% endif %}
                            </td>
                            <td class="px-4 py-2 border border-gray-300">{{ appointment.user_prescription }}</td>
                            <td class="px-4 py-2 border border-gray-300 text-justify max-h-60 overflow-y-auto">
                                {{ appointment.extract_medicine|safe }}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="py-4 text-gray-400">No consultations found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Lottie Player Script -->
<script
    src="https://unpkg.com/@lottiefiles/dotlottie-wc@0.6.2/dist/dotlottie-wc.js"
    type="module"
></script>
{% endblock %}